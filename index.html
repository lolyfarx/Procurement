<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>YN-ERP Nahdi 2026</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="loginPage">
        <div class="login-card">
            <img src="https://upload.wikimedia.org/wikipedia/ar/thumb/0/03/Nahdi_Logo.svg/1200px-Nahdi_Logo.svg.png" width="160">
            <h2 style="color:var(--primary-color); margin-top:20px;">دخول النظام الآمن</h2>
            <input type="text" id="userIn" placeholder="اسم المستخدم" style="width:100%; padding:12px; margin-bottom:10px; border:1px solid #ddd; border-radius:5px;">
            <div class="pass-group">
                <input type="password" id="passIn" placeholder="كلمة المرور" style="width:100%; padding:12px; border:1px solid #ddd; border-radius:5px;">
                <i class="fa fa-eye" id="togglePass"></i>
            </div>
            <button onclick="login()" style="width:100%; padding:12px; background:var(--primary-color); color:white; border:none; border-radius:5px; cursor:pointer; font-weight:bold;">تسجيل الدخول</button>
        </div>
    </div>

    <div id="appContainer" style="display:none;">
        <header>
            <div id="userProfile"><i class="fa fa-user-circle"></i> <span id="currentUserNameDisplay"></span></div>
            <img src="https://upload.wikimedia.org/wikipedia/ar/thumb/0/03/Nahdi_Logo.svg/1200px-Nahdi_Logo.svg.png" class="logo-center">
            <button onclick="logout()" style="background:#dc3545; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer;">خروج</button>
        </header>

        <div class="erp-wrapper">
            <aside class="sidebar">
                <div class="nav-item active" onclick="showSec('dash')"><i class="fa fa-chart-line"></i> لوحة التحكم</div>
                <div class="nav-item" onclick="showSec('po')"><i class="fa fa-cart-plus"></i> طلب شراء</div>
                <div id="menuOrderMgmt" class="nav-item" onclick="showSec('mgmt')"><i class="fa fa-tasks"></i> إدارة الطلبات</div>
                <div id="menuSettings" class="nav-item" onclick="showSec('settings')"><i class="fa fa-tools"></i> الإعدادات</div>
            </aside>

            <main class="main-content">
                <section id="sec-dash" class="section-view">
                    <h2><i class="fa fa-dashboard"></i> الإحصائيات الذكية</h2>
                    <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:20px; margin-bottom:30px;">
                        <div class="login-card" style="padding:20px; width:auto;">اليوم<h3 id="statToday">0</h3></div>
                        <div class="login-card" style="padding:20px; width:auto;">الأسبوع الماضي<h3 id="statWeek">0</h3></div>
                        <div class="login-card" style="padding:20px; width:auto;">الشهر الماضي<h3 id="statMonth">0</h3></div>
                        <div class="login-card" style="padding:20px; width:auto;">وقت مخصص<br><input type="date" id="dateFrom"> إلى <input type="date" id="dateTo"></div>
                    </div>
                    <div style="display:flex; flex-wrap:wrap; gap:20px;">
                        <div style="flex:2; background:white; padding:20px; border-radius:10px;"><canvas id="lineChart"></canvas></div>
                        <div style="flex:1; background:white; padding:20px; border-radius:10px;"><canvas id="pieChart"></canvas></div>
                    </div>
                </section>

                <section id="sec-po" class="section-view" style="display:none;">
                    <h2>إنشاء طلب شراء جديد</h2>
                    <div style="background:white; padding:20px; border-radius:10px; margin-bottom:20px; display:flex; flex-wrap:wrap; gap:15px;">
                        <div>القسم / الفرع: <select id="deptSelect" onchange="autoFillHeader()" style="padding:8px;"></select></div>
                        <div>اسم مقدم الطلب: <input type="text" id="autoUser" readonly style="background:#eee; padding:8px;"></div>
                        <div>الوظيفة: <input type="text" id="autoJob" readonly style="background:#eee; padding:8px;"></div>
                        <div>التوقيت: <input type="text" id="autoTime" readonly style="background:#eee; padding:8px;"></div>
                    </div>

                    <div class="no-print" style="margin-bottom:15px; display:flex; gap:10px;">
                        <button onclick="addRow()" style="background:#28a745; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer;"><i class="fa fa-plus"></i> إضافة بند</button>
                        <button onclick="document.getElementById('importFile').click()" style="background:#ffc107; border:none; padding:10px 20px; border-radius:5px; cursor:pointer;"><i class="fa fa-file-import"></i> استيراد Excel</button>
                        <input type="file" id="importFile" style="display:none;" onchange="importExcel(this)">
                        <button onclick="exportExcel()" style="background:#17a2b8; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer;"><i class="fa fa-file-export"></i> تصدير Excel</button>
                        <button onclick="window.print()" style="background:#6c757d; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer;"><i class="fa fa-print"></i> طباعة منسقة</button>
                    </div>

                    <table class="erp-table" id="poTable">
                        <thead>
                            <tr>
                                <th>رقم</th>
                                <th>البراند</th>
                                <th>المقاس (W / H / R)</th>
                                <th class="cost-col">التكلفة</th>
                                <th class="no-print">تحريك</th>
                                <th class="no-print">حذف</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>

                    <div id="dynamicAuthBtns" class="auth-actions-bar"></div>
                </section>

                <section id="sec-mgmt" class="section-view" style="display:none;">
                    <h2>قائمة إدارة الطلبات (البت والقرار)</h2>
                    <table class="erp-table" id="mgmtTable">
                        <thead>
                            <tr>
                                <th>كود الطلب</th>
                                <th>الفرع/القسم</th>
                                <th>بواسطة</th>
                                <th>الحالة</th>
                                <th>ملاحظات</th>
                                <th>إجراءات القرار</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </section>

                <section id="sec-settings" class="section-view" style="display:none;">
                    <h2>إعدادات النظام والمستخدمين</h2>
                    <div style="background:white; padding:20px; border-radius:10px; margin-bottom:20px;">
                        <h3>تخصيص المظهر</h3>
                        اللون الرئيسي: <input type="color" id="setThemeColor" onchange="applyTheme()">
                        حجم الخط: <input type="number" id="setFontSize" value="14" onchange="applyTheme()">
                    </div>
                    <div style="background:white; padding:20px; border-radius:10px;">
                        <h3>إضافة مستخدم جديد</h3>
                        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; margin-bottom:15px;">
                            <input type="text" id="newUname" placeholder="اسم المستخدم" style="padding:10px;">
                            <input type="text" id="newPass" placeholder="كلمة المرور" style="padding:10px;">
                            <input type="text" id="newJob" placeholder="الوظيفة" style="padding:10px;">
                        </div>
                        <h4>الصلاحيات الممنوحة:</h4>
                        <div id="permsSelection" style="display:flex; flex-wrap:wrap; gap:15px; margin-bottom:15px;">
                            <label><input type="checkbox" value="review"> مراجعة الطلب</label>
                            <label><input type="checkbox" value="edit"> التعديل على الطلب</label>
                            <label><input type="checkbox" value="cost"> إظهار التكلفة</label>
                            <label><input type="checkbox" value="stop"> إيقاف/تعليق</label>
                            <label><input type="checkbox" value="approve"> الموافقة</label>
                            <label><input type="checkbox" value="delete"> حذف الطلب</label>
                            <label><input type="checkbox" value="admin"> مدير نظام (Admin)</label>
                        </div>
                        <button onclick="addUser()" style="background:var(--primary-color); color:white; border:none; padding:10px 25px; border-radius:5px; cursor:pointer;">حفظ المستخدم</button>
                        <table class="erp-table" style="margin-top:20px;" id="usersTable">
                            <thead><tr><th>المستخدم</th><th>الوظيفة</th><th>الصلاحيات</th><th>إجراء</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </section>

                <div class="dev-credit">Developed By: Mohamed Ramadan 2026</div>
            </main>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>